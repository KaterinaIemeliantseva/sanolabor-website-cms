$((function(){var self=this,seznam_button_cart=' <a class="send_cart" href="#" title="Košarica"><i class="icon-shopping-cart icon-1_5x"></i></a>',seznam_button_obvestilo='<a class="send_obvestilo hide" href="#" title="Pošlji obvestilo"><i class="icon-envelope-alt icon-1_5x"></i></a>',seznam_button_pravna_oseba='<img title="Pravna oseba" src="/public/resources/images/user_suit.png" class="pravnaOseba hide" />',seznam_button_op='<img title="Osebni prevzem" src="/public/resources/images/user_green.png" class="osebniPrevzem hide" />';seznam_default.columns=[{data:"id"},{data:"st_narocila"},{data:"created_at"},{data:"e_posta"},{data:"ime_priimek"},{data:"nacin_placila_opis"},{data:"znesek_placila"},{data:"znesek_dostave"},{data:"partner_opis"},{data:"opombe"},{data:"nacin_placila"},{data:"_artikli"},{data:"narocilo_zakljuceno"},{data:"enota_naziv"},{data:"_cas_poslano_v_enoto"},{data:"_kupon_koda"},{data:"_kupon_brezplacna_dostava"},{data:"payment_reference_id"},{data:"kartica_potrdilo_cas"},{data:"kartica_type"},{data:"updated_at"},{data:"interna_st_racuna"},{data:"furs_stevilka"},{data:"null",width:"130px",defaultContent:'<img src="/public/resources/images/ajax-loader.gif" class="ajaxLoaderCart hide" /> '+seznam_button_pravna_oseba+seznam_button_op+seznam_button_obvestilo+seznam_button_cart+seznam_button_edit+seznam_button_delete}],seznam_default.buttons=["copy","csv","excel","pdf","print"],seznam_default.columnDefs=[{targets:[10,11,12,14,15,16,17,18,19,20,21,22],visible:!1}],seznam_default.buttons.push({extend:"csvHtml5",text:"ASW kartice",action:function(e,dt,node,config){""==$("#to").val()||""==$("#from").val()?alertify.error("Izberite datum od do!",2):exportToFile({c:"Narocila",m:"exportAsw",date_from:$("#from").val(),date_to:$("#to").val(),filename:"izvoz.csv"})}}),seznam_default.buttons.push({extend:"csvHtml5",text:"Postavke",action:function(e,dt,node,config){""==$("#to").val()||""==$("#from").val()?alertify.error("Izberite datum od do!",2):exportToFile({c:"Narocila",m:"exportNarociloPostavke",date_from:$("#from").val(),date_to:$("#to").val(),filename:"izvoz.xlsx"})}}),seznam_default.createdRow=function(row,data,dataIndex){data.stevilka_narocila?$(row).find(".send_cart").addClass("hide"):$(row).addClass("redRow"),1==data.racun_podjetje&&$(row).find(".pravnaOseba").removeClass("hide"),"148969"==data.nacin_dostave&&$(row).find(".osebniPrevzem").removeClass("hide")},seznam_default.ajax.data.audit=0,seznam_default.ajax.data.audit_message="Seznam naročil",seznam_default.ajax.data=addQueryParams(seznam_default.ajax.data,[{name:"narocilo.nacin_placila",selector:"#filter_np option:selected"},{name:"narocilo.nacin_dostave",selector:"#filter_nd option:selected"},{name:"narocilo.created_at",selector:"#from",operator:">="},{name:"narocilo.created_at",selector:"#to",operator:"<="},{name:"narocilo.racun_podjetje",selector:"#racun_podjetje:checked",operator:"="},{name:"narocilo.dostava_drzava_id",selector:"#tujina:checked",operator:"!="},{name:"narocilo.status",selector:"#nezakljucena_narocila:checked",operator:"!="},{name:"(narocilo.stevilka_narocila is null or LENGTH(narocilo.stevilka_narocila) < 1) and narocilo.nacin_placila",selector:"#neplacani_predracuni:checked",operator:"="},{name:"narocilo.vsebuje_zdravilo",selector:"#vsebuje_zdravilo:checked",operator:"="}]);var seznam=$("#seznam"),table=seznam.DataTable(seznam_default);setEditButton(seznam,table),setDeleteButton(seznam,table);var from=$("#from").datepicker({dateFormat:dateFormat,changeMonth:!0}).on("change",(function(){to.datepicker("option","minDate",getDate(this)),table.draw()})),to=$("#to").datepicker({dateFormat:dateFormat,changeMonth:!0}).on("change",(function(){from.datepicker("option","maxDate",getDate(this)),table.draw()}));function resendOrder(id,ws=0){$(".ajaxLoader1").removeClass("hide"),$.ajax({url:$("meta[name=main_url]").attr("content")+"/api/resend-order",data:{auth:$("meta[name=auth]").attr("content"),id:id,ws:ws},dataType:"jsonp",jsonpCallback:"logResults",success:function(result){result.success?(alertify.success("Uspešno. Nova številka naročila je: "+result.data,2),window.location.hash="#"+result.data,location.reload()):alertify.error("Prišlo je do napake!",2)}})}$("#filter_nd, #filter_np,  #nezakljucena_narocila, #neplacani_predracuni, #racun_podjetje, #tujina, #vsebuje_zdravilo").on("change",(function(){table.draw()})),seznam.find("tbody").on("click",".send_cart",(function(){if(confirm("Ali ste prepričani, da želite poslati naročilov v enoto?")){var self=this,data=table.row($(this).parents("tr")).data();$("tr#"+data.id+" img.ajaxLoaderCart").removeClass("hide"),$.ajax({url:$("meta[name=main_url]").attr("content")+"/api/confirmOrder",data:{auth:$("meta[name=auth]").attr("content"),id:data.id},dataType:"jsonp",jsonpCallback:"logResults",success:function(result){result.success?(alertify.success("Uspešno",2),$(self).parents("tr").removeClass("redRow"),$("tr#"+data.id+" .send_cart").addClass("hide")):alertify.error("Prišlo je do napake!",2)}}).always((function(){$("tr#"+data.id+" img.ajaxLoaderCart").addClass("hide")}))}return!1})),seznam.find("tbody").on("click",".send_obvestilo",(function(){var self=this,data=table.row($(this).parents("tr")).data();return $("tr#"+data.id+" img.ajaxLoaderCart").removeClass("hide"),$.ajax({url:$("meta[name=main_url]").attr("content")+"/api/confirmOrder",data:{auth:$("meta[name=auth]").attr("content"),id:data.id},dataType:"jsonp",jsonpCallback:"logResults",success:function(result){result.success?(alertify.success("Uspešno",2),$(self).parents("tr").removeClass("redRow"),$("tr#"+data.id+" .send_obvestilo").addClass("hide")):alertify.error("Prišlo je do napake!",2)}}).always((function(){$("tr#"+data.id+" img.ajaxLoaderCart").addClass("hide")})),!1})),$(document).on("click","#ponovnoPosljiObvestilo",(function(){if(confirm("Ali ste prepričani, da želite ponovno poslati obvestilo o naročilu?")){var id=$(this).data("id");$.ajax({url:$("meta[name=main_url]").attr("content")+"/api/sendConfirmationMail",data:{auth:$("meta[name=auth]").attr("content"),id:id},dataType:"jsonp",jsonpCallback:"logResults",success:function(result){result.success?alertify.success("Uspešno",2):alertify.error("Prišlo je do napake!",2)}})}return!1})),$(document).on("click","#ponovnoPosljiNarocilo",(function(){var id;confirm("Ali ste prepričani, da želite ponovno poslati naročilo v enoto?")&&resendOrder($(this).data("id"),1);return!1})),$(document).on("click","#podvojiNarocilo",(function(){var id;confirm("Ali ste prepričani, da želite narediti kopijo naročila?")&&resendOrder($(this).data("id"),0);return!1})),$(document).on("click","#pokaziPredracun",(function(){var id=$(this).data("id");return location.href=$("meta[name=main_url]").attr("content")+"/api/invoice?id="+id+"&auth="+$("meta[name=auth]").attr("content"),!1}))}));