$((function(){var self=this,seznam_button_duplicate=' <a class="duplicate" href="#" title="Kopiraj"><i class="icon-copy icon-1_5x"></i></a>';seznam_default.columns=[seznam_button_status,table_checkbox("arhiv"),{data:"naziv"},{data:"_sifre"},{data:"updated_at"},{data:"id"},{data:"_kategorija"},{data:"null",width:"130px",defaultContent:'<img src="/public/resources/images/ajax-loader.gif" class="ajaxLoaderCart hide" /> '+seznam_button_edit+seznam_button_delete}],seznam_default.buttons=["excel",{text:"Dodaj",action:function(e,dt,node,config){setAddButton(dt)}}],seznam_default.columnDefs=[{targets:[6],visible:!1}],seznam_default.ajax.data=addQueryParams(seznam_default.ajax.data,[{name:"artikel.arhiv",selector:"#status_arhiv:checked"},{name:"artikel_cena.ni_popusta",selector:"#ni_popusta:checked"}]);var seznam=$("#seznam"),table=seznam.DataTable(seznam_default);setDeleteButton(seznam,table),setEditButton(seznam,table),setChangeStatusButton(seznam,table),setChangeCheckboxButton(seznam,table),$("#status_arhiv").on("change",(function(){table.draw()})),$("#ni_popusta").on("change",(function(){table.draw()})),$(document).on("click",".change_checkbox",(function(e){$check=document.querySelector(".change_status").checked,$check})),$(document).on("click","#update_cene_zaloga",(function(){$(".ajaxLoaderUpdateZaloga").removeClass("hide");var sifra=$(this).data("sifra");return $.ajax({url:$("meta[name=main_url]").attr("content")+"/api/articleUpdate",data:{auth:$("meta[name=auth]").attr("content"),sifra:sifra},dataType:"jsonp",jsonp:!1,jsonpCallback:"logResults",complete:function(result){200==result.status?alertify.success("Uspešno",2):alertify.error("Prišlo je do napake!",2)}}).always((function(){$(".ajaxLoaderUpdateZaloga").addClass("hide")})),!1})),seznam.find("tbody").on("click",".duplicate",(function(){if(confirm("Ali ste prepričani, da narediti kopijo artikla?")){var self=this,data=table.row($(this).parents("tr")).data();$("tr#"+data.id+" img.ajaxLoaderCart").removeClass("hide"),$.ajax({url:$("meta[name=main_url]").attr("content")+"/api/articleDuplicate",data:{auth:$("meta[name=auth]").attr("content"),id:data.id},dataType:"jsonp",jsonpCallback:"logResults",complete:function(result){200==result.status?(alertify.success("Uspešno",2),$("#seznam").DataTable().ajax.reload(null,!1)):alertify.error("Prišlo je do napake!",2)}}).always((function(){$("tr#"+data.id+" img.ajaxLoaderCart").addClass("hide")}))}return!1}));var artikel_id=0;function preveriSifroArtikla(element,artikel_id){var $this=element,sifra=$this.val();$this.removeClass("bgred"),$this.parent().siblings(".sifra-opozorilo").addClass("hide"),sifra.length>5&&$.ajax({type:"POST",url:"/webapp/base/call",cache:!1,data:{c:"Artikel",m:"preveriSifra",sifra:sifra,artikel_id:artikel_id},success:function(data){if(data.success){var obj=data.data;"true"===obj.obstaja&&($this.addClass("bgred"),$this.parent().siblings(".sifra-opozorilo").removeClass("hide"),$this.parent().siblings(".sifra-opozorilo").find(".povezani-art").text(obj.naziv))}},error:function(XMLHttpRequest,textStatus,errorThrown){}})}function loadParameterListView(id){$.ajax({type:"POST",url:"/webapp/base/call",cache:!1,data:{c:"Artikel",m:"parameterListView",artikel_id:id},success:function(data){data.success&&($("#parameters_list").html(data.data),$(".param_sifra").each((function(index,domEle){preveriSifroArtikla($(this),id)}))),$("#loader").fadeOut()},error:function(XMLHttpRequest,textStatus,errorThrown){$("#loader").fadeOut()}})}Helper.isNumeric(Helper.hash().nivo0)&&(artikel_id=Helper.hash().nivo0),$(document).on("keyup",".param_sifra",(function(){preveriSifroArtikla($(this),artikel_id)})),$(document).on("click","#k_add",(function(){for(var id=$(this).data("id"),param_data=[],i=1;i<=10;i++)$("#k_parameter_"+i).length>0&&$("#k_parameter_"+i).val()&&(param_data=param_data.concat($("#k_parameter_"+i).val()));return $.ajax({url:$("meta[name=main_url]").attr("content")+"/api/artikel-sifra-parameter/add",data:{auth:$("meta[name=auth]").attr("content"),artikel_id:id,param_data:param_data},complete:function(result){var result_obj=JSON.parse(result.responseText);200!=result.status||result_obj.error?alertify.error(result_obj.error_msg?result_obj.error_msg:"Prišlo je do napake!",2):(loadParameterListView(id),alertify.success("Uspešno",2))}}).always((function(){})),!1})),$(window).on("hashchange ready",(function(e){var id=location.hash.substring(1);isNumeric(id)&&setTimeout(()=>{loadParameterListView(id)},800)})),$(document).on("click","#galery_tab",(function(e){$("#uf_box1 tbody").sortable({update:function(){var item_data=[];$("#uf_box1 tbody tr").each((function(index){item_data.push({order:index,id:$(this).data("uid")})})),$.ajax({type:"POST",url:"/webapp/base/call",cache:!1,data:{c:"Artikel",m:"orderGaleryItems",data:item_data},success:function(data){},error:function(XMLHttpRequest,textStatus,errorThrown){}})}}),$("#uf_box1 tbody").disableSelection()}))}));